<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DgrmJS URL åˆå§‹åŒ–åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        .test-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .test-section h3 {
            color: #495057;
            margin-top: 0;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 10px;
        }
        .test-link {
            display: inline-block;
            background: #007bff;
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 5px;
            margin: 5px 10px 5px 0;
            transition: background-color 0.3s;
        }
        .test-link:hover {
            background: #0056b3;
            color: white;
        }
        .test-link.error {
            background: #dc3545;
        }
        .test-link.error:hover {
            background: #c82333;
        }
        .test-link.success {
            background: #28a745;
        }
        .test-link.success:hover {
            background: #218838;
        }
        .description {
            color: #6c757d;
            font-size: 14px;
            margin-top: 10px;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            background: #d1ecf1;
            border: 1px solid #bee5eb;
        }
        .code {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
            overflow-x: auto;
        }
        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .file-list {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸš€ DgrmJS URL åˆå§‹åŒ–åŠŸèƒ½æµ‹è¯•</h1>
        <p>ç‚¹å‡»ä¸‹æ–¹é“¾æ¥æµ‹è¯•ä¸åŒçš„URLåˆå§‹åŒ–åœºæ™¯</p>
    </div>

    <div class="instructions">
        <h3>ğŸ“‹ æµ‹è¯•å‰å‡†å¤‡</h3>
        <ol>
            <li>ç¡®ä¿å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼š<code>npm run dev:simple</code></li>
            <li>ç¡®è®¤æœåŠ¡å™¨åœ°å€ï¼š<code>http://localhost:3001</code></li>
            <li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º</li>
        </ol>
    </div>

    <div class="file-list">
        <h3>ğŸ“ æµ‹è¯•æ–‡ä»¶åˆ—è¡¨</h3>
        <ul>
            <li><strong>test-diagram.json</strong> - æœ‰æ•ˆçš„å›¾è¡¨JSONæ–‡ä»¶ï¼ˆ4ä¸ªå…ƒç´ ï¼‰</li>
            <li><strong>invalid.json</strong> - æ— æ•ˆæ ¼å¼çš„JSONæ–‡ä»¶ï¼ˆç”¨äºé”™è¯¯æµ‹è¯•ï¼‰</li>
            <li><strong>test-diagram.png</strong> - PNGå›¾è¡¨æ–‡ä»¶ï¼ˆéœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼‰</li>
        </ul>
    </div>

    <div class="test-section">
        <h3>âœ… æ­£å¸¸åŠŸèƒ½æµ‹è¯•</h3>
        
        <h4>JSONæ ¼å¼åŠ è½½</h4>
        <a href="http://localhost:3001/index.dev.html?type=json&file=/test-diagram.json" 
           class="test-link success" target="_blank">
            ğŸ“„ å®Œæ•´è·¯å¾„JSONåŠ è½½
        </a>
        <a href="http://localhost:3001/index.dev.html?type=json&file=test-diagram" 
           class="test-link success" target="_blank">
            ğŸ“„ è‡ªåŠ¨æ‰©å±•åJSONåŠ è½½
        </a>
        <div class="description">
            æœŸæœ›ç»“æœï¼šæˆåŠŸåŠ è½½åŒ…å«è“è‰²çŸ©å½¢ã€ç»¿è‰²åœ†å½¢ã€ç°è‰²æ–‡æœ¬å’Œè¿æ¥çº¿çš„å›¾è¡¨
        </div>

        <h4>PNGæ ¼å¼åŠ è½½ï¼ˆéœ€è¦å…ˆåˆ›å»ºPNGæ–‡ä»¶ï¼‰</h4>
        <a href="http://localhost:3001/index.dev.html?type=png&file=/test-diagram.png" 
           class="test-link success" target="_blank">
            ğŸ–¼ï¸ PNGæ–‡ä»¶åŠ è½½
        </a>
        <div class="description">
            æœŸæœ›ç»“æœï¼šä»PNGæ–‡ä»¶ä¸­æå–å¹¶åŠ è½½å›¾è¡¨æ•°æ®
        </div>
    </div>

    <div class="test-section">
        <h3>âŒ é”™è¯¯å¤„ç†æµ‹è¯•</h3>
        
        <a href="http://localhost:3001/index.dev.html?type=json&file=/nonexistent.json" 
           class="test-link error" target="_blank">
            ğŸš« æ–‡ä»¶ä¸å­˜åœ¨ï¼ˆ404é”™è¯¯ï¼‰
        </a>
        <a href="http://localhost:3001/index.dev.html?type=invalid&file=/test-diagram.json" 
           class="test-link error" target="_blank">
            ğŸš« æ— æ•ˆç±»å‹å‚æ•°
        </a>
        <a href="http://localhost:3001/index.dev.html?type=json&file=/invalid.json" 
           class="test-link error" target="_blank">
            ğŸš« æ— æ•ˆJSONæ ¼å¼
        </a>
        <div class="description">
            æœŸæœ›ç»“æœï¼šæ˜¾ç¤ºç›¸åº”çš„é”™è¯¯æç¤ºå¼¹çª—å’Œæ§åˆ¶å°é”™è¯¯ä¿¡æ¯
        </div>
    </div>

    <div class="test-section">
        <h3>ğŸŒ DrupalèŠ‚ç‚¹åŠ è½½æµ‹è¯•</h3>
        
        <a href="http://localhost:3001/index.dev.html?type=drupal&uuid=12345678-1234-1234-1234-123456789abc" 
           class="test-link" target="_blank">
            ğŸ”— Drupal UUIDåŠ è½½ï¼ˆç¤ºä¾‹UUIDï¼‰
        </a>
        <div class="description">
            é€šè¿‡UUIDä»Drupal AIGCèŠ‚ç‚¹åŠ è½½å›¾è¡¨æ•°æ®ã€‚éœ€è¦æ›¿æ¢ä¸ºçœŸå®çš„èŠ‚ç‚¹UUIDã€‚
        </div>
        
        <h4>è·¨åŸŸä»£ç†æµ‹è¯•</h4>
        <a href="http://localhost:3001/index.dev.html?type=json&file=/drupal-files/sites/default/files/test.json" 
           class="test-link" target="_blank">
            ğŸ”— Drupalä»£ç†JSONåŠ è½½
        </a>
        <a href="http://localhost:3001/drupal-files/" 
           class="test-link" target="_blank">
            ğŸ”— ç›´æ¥è®¿é—®ä»£ç†è·¯å¾„
        </a>
        <div class="description">
            æ³¨æ„ï¼šè¿™äº›æµ‹è¯•éœ€è¦DrupalæœåŠ¡å™¨ä¸Šå­˜åœ¨å¯¹åº”æ–‡ä»¶ï¼Œå¯èƒ½è¿”å›404é”™è¯¯
        </div>
    </div>

    <div class="test-section">
        <h3>ğŸ”§ æœåŠ¡å™¨çŠ¶æ€æ£€æŸ¥</h3>
        
        <a href="http://localhost:3001/health" 
           class="test-link" target="_blank">
            â¤ï¸ å¥åº·æ£€æŸ¥
        </a>
        <a href="http://localhost:3001/debug/cookies" 
           class="test-link" target="_blank">
            ğŸª Cookieè°ƒè¯•
        </a>
        <a href="http://localhost:3001/test-diagram.json" 
           class="test-link" target="_blank">
            ğŸ“„ ç›´æ¥è®¿é—®JSONæ–‡ä»¶
        </a>
        <div class="description">
            ç”¨äºéªŒè¯æœåŠ¡å™¨çŠ¶æ€å’Œæ–‡ä»¶è®¿é—®æƒé™
        </div>
    </div>

    <div class="test-section">
        <h3>ğŸ§ª è‡ªåŠ¨åŒ–æµ‹è¯•</h3>
        <button onclick="runAutomatedTests()" class="test-link">
            ğŸ¤– è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
        </button>
        <div class="description">
            åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰¹é‡æ‰“å¼€æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹
        </div>
    </div>

    <div class="test-section">
        <h3>ğŸ” ç¼©æ”¾å‚æ•°æµ‹è¯•</h3>
        <p>æµ‹è¯•åˆå§‹ç¼©æ”¾å€¼è®¾ç½®åŠŸèƒ½</p>
        
        <h4>ä»…è®¾ç½®ç¼©æ”¾å€¼ï¼ˆç©ºç™½ç”»å¸ƒï¼‰</h4>
        <a href="http://localhost:3001/index.dev.html?scale=0.1" class="test-link" target="_blank">10% ç¼©æ”¾ï¼ˆæœ€å°ï¼‰</a>
        <a href="http://localhost:3001/index.dev.html?scale=0.2" class="test-link" target="_blank">20% ç¼©æ”¾</a>
        <a href="http://localhost:3001/index.dev.html?scale=0.25" class="test-link" target="_blank">25% ç¼©æ”¾</a>
        <a href="http://localhost:3001/index.dev.html?scale=0.4" class="test-link" target="_blank">40% ç¼©æ”¾</a>
        <a href="http://localhost:3001/index.dev.html?scale=0.5" class="test-link" target="_blank">50% ç¼©æ”¾</a>
        <a href="http://localhost:3001/index.dev.html?scale=0.75" class="test-link" target="_blank">75% ç¼©æ”¾</a>
        <a href="http://localhost:3001/index.dev.html?scale=1.0" class="test-link" target="_blank">100% ç¼©æ”¾ï¼ˆé»˜è®¤ï¼‰</a>
        <a href="http://localhost:3001/index.dev.html?scale=1.5" class="test-link" target="_blank">150% ç¼©æ”¾</a>
        <a href="http://localhost:3001/index.dev.html?scale=2.0" class="test-link" target="_blank">200% ç¼©æ”¾</a>
        <a href="http://localhost:3001/index.dev.html?scale=4.0" class="test-link" target="_blank">400% ç¼©æ”¾ï¼ˆæœ€å¤§ï¼‰</a>
        
        <h4>åŠ è½½å›¾è¡¨ + ç¼©æ”¾è®¾ç½®</h4>
        <a href="http://localhost:3001/index.dev.html?type=json&file=/test-diagram.json&scale=0.2" class="test-link" target="_blank">åŠ è½½æµ‹è¯•å›¾è¡¨ + 20% ç¼©æ”¾</a>
        <a href="http://localhost:3001/index.dev.html?type=json&file=/test-diagram.json&scale=0.4" class="test-link" target="_blank">åŠ è½½æµ‹è¯•å›¾è¡¨ + 40% ç¼©æ”¾</a>
        <a href="http://localhost:3001/index.dev.html?type=json&file=/test-diagram.json&scale=0.5" class="test-link" target="_blank">åŠ è½½æµ‹è¯•å›¾è¡¨ + 50% ç¼©æ”¾</a>
        <a href="http://localhost:3001/index.dev.html?type=json&file=/test-diagram.json&scale=1.5" class="test-link" target="_blank">åŠ è½½æµ‹è¯•å›¾è¡¨ + 150% ç¼©æ”¾</a>
        <a href="http://localhost:3001/index.dev.html?type=json&file=/test-diagram.json&scale=2.0" class="test-link" target="_blank">åŠ è½½æµ‹è¯•å›¾è¡¨ + 200% ç¼©æ”¾</a>
        
        <h4>é”™è¯¯å¤„ç†æµ‹è¯•</h4>
        <a href="http://localhost:3001/index.dev.html?scale=0.05" class="test-link error" target="_blank">æ— æ•ˆç¼©æ”¾å€¼ï¼ˆ0.05ï¼Œå°äºæœ€å°å€¼ï¼‰</a>
        <a href="http://localhost:3001/index.dev.html?scale=5.0" class="test-link error" target="_blank">æ— æ•ˆç¼©æ”¾å€¼ï¼ˆ5.0ï¼Œå¤§äºæœ€å¤§å€¼ï¼‰</a>
        <a href="http://localhost:3001/index.dev.html?scale=abc" class="test-link error" target="_blank">æ— æ•ˆç¼©æ”¾å€¼ï¼ˆéæ•°å­—ï¼‰</a>
        
        <div class="description">
            <strong>ç¼©æ”¾å‚æ•°è¯´æ˜ï¼š</strong><br>
            â€¢ æœ‰æ•ˆèŒƒå›´ï¼š0.1 - 4.0<br>
            â€¢ é»˜è®¤å€¼ï¼š1.0<br>
            â€¢ è¶…å‡ºèŒƒå›´æˆ–æ— æ•ˆå€¼å°†ä½¿ç”¨é»˜è®¤å€¼<br>
            â€¢ æ§åˆ¶å°ä¼šæ˜¾ç¤ºç›¸åº”çš„æ—¥å¿—ä¿¡æ¯
        </div>
    </div>

    <div class="status">
        <h3>ğŸ“Š æµ‹è¯•çŠ¶æ€ç›‘æ§</h3>
        <p>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰æŸ¥çœ‹è¯¦ç»†çš„æµ‹è¯•ç»“æœï¼š</p>
        <div class="code">
ğŸ”„ Initializing diagram from URL: type=json, file=/test-diagram.json
ğŸ“„ Loading JSON diagram from: /test-diagram.json
âœ… Successfully loaded JSON diagram with 4 elements
        </div>
        <p><strong>æˆåŠŸæ ‡å¿—ï¼š</strong></p>
        <ul>
            <li>âœ… æ§åˆ¶å°æ˜¾ç¤ºæˆåŠŸåŠ è½½ä¿¡æ¯</li>
            <li>ğŸ“Š å›¾è¡¨æ­£ç¡®æ˜¾ç¤ºåœ¨ç”»å¸ƒä¸Š</li>
            <li>ğŸ¯ æç¤ºä¿¡æ¯è‡ªåŠ¨éšè—</li>
            <li>ğŸ“ å†å²è®°å½•æ­£ç¡®åˆå§‹åŒ–</li>
        </ul>
    </div>

    <script>
        function runAutomatedTests() {
            const testCases = [
                // æˆåŠŸæµ‹è¯•
                { name: 'JSONå®Œæ•´è·¯å¾„', url: '?type=json&file=/test-diagram.json' },
                { name: 'JSONè‡ªåŠ¨æ‰©å±•å', url: '?type=json&file=test-diagram' },
                
                // Drupalæµ‹è¯•
                { name: 'Drupal UUIDåŠ è½½', url: '?type=drupal&uuid=12345678-1234-1234-1234-123456789abc' },
                
                // é”™è¯¯æµ‹è¯•
                { name: 'æ–‡ä»¶ä¸å­˜åœ¨', url: '?type=json&file=/nonexistent.json' },
                { name: 'æ— æ•ˆç±»å‹', url: '?type=invalid&file=/test-diagram.json' },
                { name: 'æ— æ•ˆJSON', url: '?type=json&file=/invalid.json' },
                { name: 'Drupalæ— æ•ˆUUID', url: '?type=drupal&uuid=invalid-uuid' },
                
                // ä»£ç†æµ‹è¯•
                { name: 'Drupalä»£ç†', url: '?type=json&file=/drupal-files/sites/default/files/test.json' }
            ];
            
            console.log('ğŸ¤– å¼€å§‹è‡ªåŠ¨åŒ–æµ‹è¯•...');
            
            testCases.forEach((testCase, index) => {
                setTimeout(() => {
                    const url = `http://localhost:3001/index.dev.html${testCase.url}`;
                    console.log(`ğŸ“‹ æµ‹è¯• ${index + 1}/${testCases.length}: ${testCase.name}`);
                    console.log(`ğŸ”— URL: ${url}`);
                    window.open(url, `_blank_test_${index}`);
                }, index * 1000); // æ¯ç§’æ‰“å¼€ä¸€ä¸ªæµ‹è¯•
            });
            
            console.log(`âœ… å·²å®‰æ’ ${testCases.length} ä¸ªæµ‹è¯•ç”¨ä¾‹`);
            alert(`ğŸ¤– è‡ªåŠ¨åŒ–æµ‹è¯•å·²å¯åŠ¨ï¼\n\nå°†åœ¨ ${testCases.length} ç§’å†…ä¾æ¬¡æ‰“å¼€ ${testCases.length} ä¸ªæµ‹è¯•æ ‡ç­¾é¡µã€‚\n\nè¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°å’Œå„ä¸ªæ ‡ç­¾é¡µçš„ç»“æœã€‚`);
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
        window.addEventListener('load', async () => {
            try {
                const response = await fetch('http://localhost:3001/health');
                if (response.ok) {
                    const data = await response.json();
                    console.log('âœ… æœåŠ¡å™¨çŠ¶æ€æ­£å¸¸:', data);
                } else {
                    console.warn('âš ï¸ æœåŠ¡å™¨å“åº”å¼‚å¸¸:', response.status);
                }
            } catch (error) {
                console.error('âŒ æ— æ³•è¿æ¥åˆ°å¼€å‘æœåŠ¡å™¨:', error);
                alert('âŒ æ— æ³•è¿æ¥åˆ°å¼€å‘æœåŠ¡å™¨ï¼\n\nè¯·ç¡®ä¿å·²å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼šnpm run dev:simple');
            }
        });
    </script>
</body>
</html> 